{{/*
    è¿™ä¸ªå±€éƒ¨æ¨¡æ¿è´Ÿè´£æ¸²æŸ“æœ‹å‹åœˆåˆ—è¡¨ã€‚
    åŠŸèƒ½ï¼šç‚¹å‡»æ–‡ç« åˆ—è¡¨é¡¹ï¼Œä»¥ä»å³ä¾§æ»‘å…¥çš„åŠ¨ç”»åœ¨å½“å‰é¡µé¢åˆ‡æ¢æ˜¾ç¤ºå…¨æ–‡ï¼Œå¹¶æ”¯æŒæ‰‹åŠ¿è¿”å›ã€‚
    æœ€ç»ˆä¼˜åŒ– (VS Code é£æ ¼ + å›¾ç‰‡æŸ¥çœ‹å™¨): 
    - åŠ¨æ€åŠ è½½é«˜äº®åº“ï¼Œå®ç°å¸¦å¤´éƒ¨çš„VSCodeé£æ ¼ä»£ç å—ã€‚
    - ç‚¹å‡»æ–‡ç« å†…å›¾ç‰‡å¯æ‰“å¼€ä¸€ä¸ªæ”¯æŒç¼©æ”¾å’Œå¹³ç§»çš„ lightbox æŸ¥çœ‹å™¨ã€‚
*/}}

{{/* 1. ä» Hugo æ•°æ®æ–‡ä»¶ä¸­è·å–æ•°æ® */}}
{{ $feedData := index .Site.Data "friends_feed" }}
{{ $articles := $feedData.articles }}
{{ $categories := $feedData.meta.categories }}

{{/* 2. ä¸»å®¹å™¨ (åŠ¨ç”»å’Œæ‰‹åŠ¿çš„å…³é”®) */}}
<div id="friends-feed-wrapper">
    {{/* åˆ—è¡¨è§†å›¾ */}}
    <div id="friends-list-view" class="feed-view">
        {{/* åˆ†ç±»ç­›é€‰æŒ‰é’®åŒºåŸŸ */}}
        <div class="feed-filter-container">
            <div id="feed-main-categories" class="filter-bar main-bar">
                <button class="category-btn main-btn active" data-filter-type="all" data-filter-value="all">å…¨éƒ¨</button>
                {{ range $categoryName, $category := $categories }}
                    {{ if gt $category.count 0 }}
                    <button class="category-btn main-btn" data-filter-type="category" data-filter-value="{{ $categoryName }}">
                        {{ with $category.icon }}{{ . }}{{ end }} {{ $categoryName }}
                    </button>
                    {{ end }}
                {{ end }}
            </div>
            <div id="feed-sub-categories" class="filter-bar sub-bar"></div>
        </div>

        {{/* æ–‡ç« åˆ—è¡¨å®¹å™¨ å’Œ åŠ è½½æŒ‡ç¤ºå™¨ */}}
        <div id="friends-feed-list" class="friends-feed-list" style="display: flex; flex-direction: column; gap: 2rem;"></div>
        <div id="feed-loader" style="text-align: center; padding: 20px; display: none;">
            <p>æ­£åœ¨åŠ è½½æ›´å¤š...</p>
        </div>
    </div>

    {{/* æ–‡ç« å†…å®¹è¯¦æƒ…è§†å›¾ */}}
    <div id="article-detail-view" class="feed-view">
        <div class="detail-view-content-wrapper">
            <button id="detail-view-close" class="detail-view-close-btn" aria-label="è¿”å›åˆ—è¡¨">&larr; è¿”å›åˆ—è¡¨</button>
            <div class="detail-header">
                <h2 id="detail-title"></h2>
                <div id="detail-meta" class="entry-footer"></div>
            </div>
            <div id="detail-body" class="detail-body-content post-content"></div>
        </div>
    </div>
</div>


{{/* 3. å›¾ç‰‡ Lightbox æŸ¥çœ‹å™¨çš„ HTML ç»“æ„ */}}
<div id="image-lightbox" class="lightbox-overlay">
    <div class="lightbox-content">
        <img id="lightbox-image" src="" alt="æ”¾å¤§çš„å›¾ç‰‡">
    </div>
    <button id="lightbox-close" class="lightbox-close-btn" aria-label="å…³é—­">&times;</button>
</div>


{{/* 4. æ ¸å¿ƒ JavaScript é€»è¾‘ (æ— éœ€æ”¹åŠ¨) */}}
<script>
document.addEventListener('DOMContentLoaded', function () {
    const allArticles = {{ $articles | jsonify | safeJS }};
    const allCategoriesData = {{ $categories | jsonify | safeJS }};
    
    const wrapper = document.getElementById('friends-feed-wrapper');
    const listView = document.getElementById('friends-list-view');
    const detailView = document.getElementById('article-detail-view');
    const articlesContainer = document.getElementById('friends-feed-list');
    if (!Array.isArray(allArticles) || allArticles.length === 0) {
        articlesContainer.innerHTML = '<div class="post-content"><p>æš‚æ—¶æ²¡æœ‰åŠ¨æ€ä¿¡æ¯ã€‚</p></div>'; return;
    }
    const mainCategoriesContainer = document.getElementById('feed-main-categories');
    const subCategoriesContainer = document.getElementById('feed-sub-categories');
    const loader = document.getElementById('feed-loader');
    const detailTitle = document.getElementById('detail-title');
    const detailMeta = document.getElementById('detail-meta');
    const detailBody = document.getElementById('detail-body');
    const detailCloseBtn = document.getElementById('detail-view-close');
    let currentFilter = { main: 'all', sub: 'all' };
    let displayedArticles = [], articlesToDisplay = [], isLoading = false;
    const articlesPerPage = 10;

    function renderSubCategories(categoryName) {
        const categoryData = allCategoriesData[categoryName];
        if (!categoryData) { subCategoriesContainer.innerHTML = ''; subCategoriesContainer.classList.remove('is-visible'); return; }
        let subHTML = `<button class="category-btn sub-btn active" data-filter-type="category_all" data-filter-value="${categoryName}">å…¨éƒ¨ ${categoryName}</button>`;
        for (const sourceName in categoryData.sources) {
            const source = categoryData.sources[sourceName];
            if (source.count > 0) { subHTML += `<button class="category-btn sub-btn" data-filter-type="source" data-filter-value="${sourceName}">${source.icon || ''} ${sourceName}</button>`; }
        }
        subCategoriesContainer.innerHTML = subHTML; subCategoriesContainer.classList.add('is-visible');
    }

    function updateFilterUI() {
        mainCategoriesContainer.querySelectorAll('.category-btn').forEach(btn => btn.classList.toggle('active', btn.dataset.filterValue === currentFilter.main));
        if (currentFilter.main === 'all') { subCategoriesContainer.classList.remove('is-visible'); subCategoriesContainer.innerHTML = '';
        } else { subCategoriesContainer.querySelectorAll('.category-btn').forEach(btn => btn.classList.toggle('active', btn.dataset.filterValue === currentFilter.sub)); }
    }

    function filterArticles() {
        articlesContainer.innerHTML = ''; displayedArticles = [];
        if (currentFilter.main === 'all') { articlesToDisplay = allArticles; } 
        else if (currentFilter.sub === currentFilter.main) { articlesToDisplay = allArticles.filter(a => a.category === currentFilter.main); }
        else { articlesToDisplay = allArticles.filter(a => a.blog_name === currentFilter.sub); }
        if (articlesToDisplay.length === 0) { articlesContainer.innerHTML = '<div class="post-content"><p>è¯¥ç­›é€‰æ¡ä»¶ä¸‹æš‚æ—¶æ²¡æœ‰åŠ¨æ€ã€‚</p></div>'; }
        else { loadMoreArticles(); }
        setTimeout(() => updateWrapperHeight(listView), 100);
    }

    mainCategoriesContainer.addEventListener('click', e => {
        const button = e.target.closest('.category-btn'); if (!button) return;
        const value = button.dataset.filterValue;
        if (value === currentFilter.main && value !== 'all') { currentFilter = { main: 'all', sub: 'all' }; }
        else { currentFilter = { main: value, sub: value }; if (value !== 'all') { renderSubCategories(value); } }
        updateFilterUI(); filterArticles();
    });

    subCategoriesContainer.addEventListener('click', e => {
        const button = e.target.closest('.category-btn'); if (!button) return;
        const value = button.dataset.filterValue;
        if (value !== currentFilter.sub) { currentFilter.sub = value; updateFilterUI(); filterArticles(); }
    });

    const handleScroll = () => {
        if (!wrapper.classList.contains('detail-view-active') && window.innerHeight + window.scrollY >= document.documentElement.scrollHeight - 300 && !isLoading && displayedArticles.length < articlesToDisplay.length) { 
            loadMoreArticles(); 
        }
    };
    window.addEventListener('scroll', handleScroll);

    function createArticleHTML(article) {
        const d = new Date(article.published).toLocaleString('zh-CN', { year: 'numeric', month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' });
        const tempDiv = document.createElement('div');
        tempDiv.innerHTML = article.content || article.summary;
        let summaryText = tempDiv.textContent || tempDiv.innerText || "";
        summaryText = summaryText.length > 150 ? summaryText.substring(0, 150) + '...' : summaryText;
        return `
        <article class="post-entry">
            <header class="entry-header">
                <h2 class="entry-hint-parent"><a href="javascript:void(0);" class="read-more-trigger" data-id="${article.id}">${article.title}</a></h2>
            </header>
            <div class="entry-content"><p>${summaryText}</p></div>
            <footer class="entry-footer">
                <span title="${article.blog_name}">${article.source_icon} ${article.blog_name}</span>&nbsp;Â·&nbsp;<time>${d}</time>
            </footer>
        </article>`;
    }

    function loadMoreArticles() {
        if (isLoading) return;
        isLoading = true;
        loader.style.display = 'block';
        setTimeout(() => {
            const startIndex = displayedArticles.length;
            const endIndex = startIndex + articlesPerPage;
            const articlesChunk = articlesToDisplay.slice(startIndex, endIndex);
            if (articlesChunk.length > 0) {
                let articlesHTML = '';
                articlesChunk.forEach(article => { articlesHTML += createArticleHTML(article); });
                articlesContainer.insertAdjacentHTML('beforeend', articlesHTML);
                displayedArticles = displayedArticles.concat(articlesChunk);
            }
            loader.style.display = 'none';
            isLoading = false;
            updateWrapperHeight(listView);
        }, 300);
    }
    
    function updateWrapperHeight(activeView) {
        requestAnimationFrame(() => {
            const height = activeView.scrollHeight;
            wrapper.style.height = height + 'px';
        });
    }

    let hljsPromise = null;
    function loadHljs() {
        if (!hljsPromise) {
            hljsPromise = new Promise((resolve, reject) => {
                if (window.hljs) { return resolve(window.hljs); }
                const style = document.createElement('link');
                style.rel = 'stylesheet';
                style.href = 'https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/vs2015.min.css';
                document.head.appendChild(style);
                const script = document.createElement('script');
                script.src = 'https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js';
                script.onload = () => resolve(window.hljs);
                script.onerror = reject;
                document.head.appendChild(script);
            });
        }
        return hljsPromise;
    }

    function enhanceCodeBlock(preElement) {
        if (preElement.parentElement.classList.contains('code-block-wrapper')) return;
        const codeElement = preElement.querySelector('code');
        const wrapper = document.createElement('div');
        wrapper.className = 'code-block-wrapper';
        const header = document.createElement('div');
        header.className = 'code-block-header';
        const langMatch = codeElement.className.match(/language-(\S+)/);
        const langName = document.createElement('span');
        langName.className = 'language-name';
        langName.textContent = langMatch ? langMatch[1] : '';
        const copyButton = document.createElement('button');
        copyButton.className = 'copy-code-button';
        const copyIconSVG = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>`;
        const checkIconSVG = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>`;
        copyButton.innerHTML = `<span class="copy-icon">${copyIconSVG}</span><span class="copy-text">å¤åˆ¶</span>`;
        copyButton.addEventListener('click', () => {
            navigator.clipboard.writeText(codeElement.innerText).then(() => {
                copyButton.innerHTML = `<span class="copy-icon">${checkIconSVG}</span><span class="copy-text">å·²å¤åˆ¶!</span>`;
                copyButton.classList.add('copied');
                setTimeout(() => {
                    copyButton.innerHTML = `<span class="copy-icon">${copyIconSVG}</span><span class="copy-text">å¤åˆ¶</span>`;
                    copyButton.classList.remove('copied');
                }, 2000);
            });
        });
        header.appendChild(langName);
        header.appendChild(copyButton);
        preElement.parentNode.insertBefore(wrapper, preElement);
        wrapper.appendChild(header);
        wrapper.appendChild(preElement);
    }

    function showArticleDetail(articleId) {
        const article = allArticles.find(a => a.id === articleId);
        if (!article) return;
        detailTitle.textContent = article.title;
        const d = new Date(article.published).toLocaleString('zh-CN', { year: 'numeric', month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' });
        detailMeta.innerHTML = `
            <span title="${article.blog_name}">${article.source_icon} ${article.blog_name}</span>&nbsp;Â·&nbsp;
            <time>${d}</time>&nbsp;Â·&nbsp;
            <a href="${article.link}" target="_blank" rel="noopener noreferrer">æŸ¥çœ‹åŸæ–‡</a>
        `;
        detailBody.innerHTML = article.content || '<p>æ­¤æ–‡ç« æ²¡æœ‰æä¾›æ­£æ–‡å†…å®¹ã€‚</p>'; 
        detailBody.querySelectorAll('img').forEach(img => {
            img.classList.remove('image-error');
            img.onerror = function() { this.classList.add('image-error'); this.onerror = null; };
        });
        const codeBlocks = detailBody.querySelectorAll('pre code');
        if (codeBlocks.length > 0) {
            loadHljs().then(hljs => {
                codeBlocks.forEach((block) => {
                    hljs.highlightElement(block);
                    if (block.parentElement.tagName === 'PRE') enhanceCodeBlock(block.parentElement);
                });
            }).catch(err => console.error("Highlight.js åŠ è½½å¤±è´¥:", err));
        }
        wrapper.classList.add('detail-view-active');
        updateWrapperHeight(detailView);
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }
    
    function hideArticleDetail() {
        if (!wrapper.classList.contains('detail-view-active')) return;
        wrapper.classList.remove('detail-view-active');
        updateWrapperHeight(listView);
    }

    articlesContainer.addEventListener('click', function(e) {
        const trigger = e.target.closest('.read-more-trigger');
        if (trigger && trigger.dataset.id) { 
            e.preventDefault(); 
            showArticleDetail(trigger.dataset.id); 
        }
    });
    detailCloseBtn.addEventListener('click', hideArticleDetail);
    document.addEventListener('keydown', function(e) { 
        if (e.key === "Escape" && wrapper.classList.contains('detail-view-active')) { 
            hideArticleDetail(); 
        } 
    });
    
    let touchStartX = 0, touchStartY = 0;
    const gestureZoneWidth = 50, gestureMinSwipeX = 80, gestureMaxSwipeY = 100;

    detailView.addEventListener('touchstart', (e) => {
        const touch = e.touches[0];
        touchStartX = touch.clientX;
        touchStartY = touch.clientY;
    });

    detailView.addEventListener('touchmove', (e) => {
        if (touchStartX === 0 || touchStartX > gestureZoneWidth) return;
        const touch = e.touches[0];
        const deltaX = touch.clientX - touchStartX;
        const deltaY = Math.abs(touch.clientY - touchStartY);
        if (deltaX > 10 && deltaX > deltaY) e.preventDefault();
    });

    detailView.addEventListener('touchend', (e) => {
        if (touchStartX === 0 || touchStartX > gestureZoneWidth) { touchStartX = 0; return; }
        const touch = e.changedTouches[0];
        const deltaX = touch.clientX - touchStartX;
        const deltaY = Math.abs(touch.clientY - touchStartY);
        if (deltaX > gestureMinSwipeX && deltaY < gestureMaxSwipeY) hideArticleDetail();
        touchStartX = 0; touchStartY = 0;
    });

    const lightbox = document.getElementById('image-lightbox');
    const lightboxImage = document.getElementById('lightbox-image');
    const lightboxCloseBtn = document.getElementById('lightbox-close');
    let isDragging = false, scale = 1, startPos = { x: 0, y: 0 }, currentTranslate = { x: 0, y: 0 };
    function openLightbox(src) { lightboxImage.setAttribute('src', src); resetImageTransform(); lightbox.classList.add('is-visible'); document.body.style.overflow = 'hidden'; }
    function closeLightbox() { lightbox.classList.remove('is-visible'); document.body.style.overflow = ''; }
    function resetImageTransform() { scale = 1; currentTranslate = { x: 0, y: 0 }; applyTransform(); }
    function applyTransform() { lightboxImage.style.transform = `translate(${currentTranslate.x}px, ${currentTranslate.y}px) scale(${scale})`; }
    detailBody.addEventListener('click', (e) => { if (e.target.tagName === 'IMG' && !e.target.classList.contains('image-error')) openLightbox(e.target.src); });
    lightboxCloseBtn.addEventListener('click', closeLightbox);
    lightbox.addEventListener('click', (e) => { if (e.target === lightbox) closeLightbox(); });
    document.addEventListener('keydown', (e) => { if (e.key === "Escape" && lightbox.classList.contains('is-visible')) closeLightbox(); });
    lightboxImage.addEventListener('wheel', (e) => { e.preventDefault(); const s = e.deltaY > 0 ? -0.1 : 0.1; scale = Math.min(Math.max(0.5, scale + s), 5); applyTransform(); });
    lightboxImage.addEventListener('mousedown', (e) => { e.preventDefault(); isDragging = true; startPos = { x: e.clientX - currentTranslate.x, y: e.clientY - currentTranslate.y }; lightboxImage.style.cursor = 'grabbing'; });
    window.addEventListener('mousemove', (e) => { if (!isDragging) return; currentTranslate.x = e.clientX - startPos.x; currentTranslate.y = e.clientY - startPos.y; applyTransform(); });
    window.addEventListener('mouseup', () => { isDragging = false; lightboxImage.style.cursor = 'grab'; });
    
    filterArticles();
});
</script>


{{/* 5. CSS æ ·å¼ (å·²ä¿®æ­£) */}}
<style>
    /* --- ä¸»å®¹å™¨å’Œè§†å›¾åˆ‡æ¢åŠ¨ç”» (å…³é”®ä¿®æ­£) --- */
    #friends-feed-wrapper {
        position: relative;
        overflow-x: hidden;
        transition: height 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
    }
    .feed-view {
        /* ä¸¤ä¸ªè§†å›¾éƒ½ç»å¯¹å®šä½ï¼Œè„±ç¦»æ–‡æ¡£æµ */
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        transition: transform 0.4s cubic-bezier(0.25, 0.8, 0.25, 1), 
                    opacity 0.3s ease;
    }
    #friends-list-view {
        /* åˆ—è¡¨è§†å›¾åˆå§‹åœ¨å±å¹•å†… */
        transform: translateX(0);
        opacity: 1;
    }
    #article-detail-view {
        /* è¯¦æƒ…è§†å›¾åˆå§‹åœ¨å±å¹•å³ä¾§å¤– */
        transform: translateX(100%);
        opacity: 0;
        visibility: hidden;
        transition-property: transform, opacity, visibility;
        transition-delay: 0s, 0s, 0.4s;
    }
    #friends-feed-wrapper.detail-view-active #friends-list-view {
        /* æ¿€æ´»æ—¶ï¼Œåˆ—è¡¨è§†å›¾æ»‘åˆ°å·¦ä¾§å¤– */
        transform: translateX(-100%);
        opacity: 0;
        visibility: hidden;
        transition-delay: 0s, 0s, 0.4s;
    }
    #friends-feed-wrapper.detail-view-active #article-detail-view {
        /* æ¿€æ´»æ—¶ï¼Œè¯¦æƒ…è§†å›¾æ»‘å…¥å±å¹• */
        transform: translateX(0);
        opacity: 1;
        visibility: visible;
        transition-delay: 0s, 0.1s, 0s;
    }

    /* --- åŸºç¡€ä¸ç­›é€‰æŒ‰é’®æ ·å¼ --- */
    .feed-filter-container { display: flex; flex-direction: column; gap: 16px; margin-bottom: 2.5rem; }
    .filter-bar { display: flex; flex-wrap: wrap; gap: 12px; align-items: center; }
    .main-btn { padding: 8px 16px; border: 1px solid var(--border-color); background-color: var(--code-bg); color: var(--primary); border-radius: 8px; cursor: pointer; font-size: 0.9em; font-weight: 500; transition: all 0.15s ease-out; }
    .main-btn.active { background-color: var(--primary); color: var(--entry); border-color: var(--primary); font-weight: 600; box-shadow: 0 4px 14px 0 rgba(var(--primary-rgb), 0.25); }
    .main-btn:hover:not(.active) { background-color: var(--primary); color: var(--entry); border-color: var(--primary); font-weight: 600; box-shadow: 0 4px 14px 0 rgba(var(--primary-rgb), 0.25); opacity: 0.6; transform: scale(1.03); }
    .sub-btn { padding: 5px 14px; border: 2px solid transparent; background-color: var(--code-bg); color: var(--secondary); border-radius: 9999px; font-size: 0.85em; font-weight: 400; cursor: pointer; transition: all 0.15s ease-out; }
    .sub-btn.active { border-color: #FFFFFF; color: var(--primary); font-weight: 500; background-color: var(--code-bg); }
    .sub-btn:hover:not(.active) { border-color: rgba(255, 255, 255, 0.2); color: var(--primary); background-color: var(--code-bg); transform: scale(1.03); }
    .sub-bar { display: none; }
    .sub-bar.is-visible { display: flex; }
    .read-more-trigger { text-decoration: none; color: inherit; cursor: pointer; }
    .read-more-trigger:hover { text-decoration: underline; }

    /* --- æ–‡ç« è¯¦æƒ…è§†å›¾æ ·å¼ --- */
    .detail-view-content-wrapper { background-color: var(--entry); padding: 0.5rem 1rem; border-radius: 12px; border: 1px solid var(--border-color); }
    .detail-view-close-btn { display: inline-block; margin-bottom: 2rem; background: var(--code-bg); border: 1px solid var(--border-color); color: var(--primary); padding: 8px 16px; border-radius: 8px; cursor: pointer; font-size: 0.9em; font-weight: 500; transition: all 0.2s ease; }
    .detail-view-close-btn:hover { background-color: var(--primary); border-color: var(--primary); color: var(--entry); }
    .detail-header { padding-bottom: 1rem; border-bottom: 1px solid var(--border-color); margin-bottom: 1.5rem; }
    #detail-title { margin: 0 0 0.5rem 0; font-size: 2em; line-height: 1.3; }
    .detail-body-content { max-height: none; overflow-y: visible; }

    /* --- å†…å®¹æ ·å¼ --- */
    .detail-body-content img { max-width: 100%; height: auto; display: block; margin: 1em 0; border-radius: 8px; background-color: var(--code-bg); cursor: zoom-in; }
    .detail-body-content img.image-error { position: relative; min-height: 150px; width: 100%; font-size: 0.9em; color: var(--secondary); filter: grayscale(100%); content: ''; cursor: default; }
    .detail-body-content img.image-error::before { content: 'ğŸ–¼ï¸'; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 2.5em; opacity: 0.5; }
    .detail-body-content img.image-error::after { content: 'å›¾ç‰‡åŠ è½½å¤±è´¥'; position: absolute; bottom: 1em; left: 50%; transform: translateX(-50%); font-family: sans-serif; }
    .detail-body-content video, .detail-body-content audio { max-width: 100%; height: auto; display: block; margin: 1em 0; }
    .detail-body-content :not(pre) > code { font-family: 'SF Mono', 'Fira Code', monospace; font-size: 0.9em; background-color: var(--code-bg); padding: 0.2em 0.4em; border-radius: 4px; color: var(--primary); }
    
    /* --- VS Code é£æ ¼ä»£ç å—æ ·å¼ --- */
    .code-block-wrapper { margin: 1.5em 0; border: 1px solid var(--border-color); border-radius: 8px; overflow: hidden; background-color: #1E1E1E; }
    .code-block-header { display: flex; justify-content: space-between; align-items: center; padding: 0.6em 0.8em; background-color: #333333; border-bottom: 1px solid var(--border-color); }
    .language-name { font-family: 'JetBrains Mono', 'Fira Code', 'SF Mono', monospace; font-size: 0.8em; color: #cccccc; text-transform: lowercase; }
    .copy-code-button { display: inline-flex; align-items: center; gap: 0.4em; padding: 0.4em 0.6em; font-size: 0.8em; background-color: transparent; color: #cccccc; border: none; border-radius: 6px; cursor: pointer; transition: all 0.2s ease; }
    .copy-code-button:hover { background-color: rgba(255, 255, 255, 0.1); color: #ffffff; }
    .copy-code-button.copied { color: #4CAF50; }
    .copy-code-button svg { width: 16px; height: 16px; }
    .detail-body-content pre { margin: 0; border: none; border-radius: 0; padding: 1.2em; overflow-x: auto; background: #1E1E1E !important; }
    .detail-body-content pre code.hljs { font-family: 'JetBrains Mono', 'Fira Code', 'SF Mono', 'Consolas', 'Courier New', monospace; font-size: 0.9em; line-height: 1.6; background: none !important; padding: 0 !important; }

    /* --- å›¾ç‰‡ Lightbox æ ·å¼ --- */
    .lightbox-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.85); display: flex; align-items: center; justify-content: center; z-index: 2000; opacity: 0; visibility: hidden; transition: opacity 0.3s ease, visibility 0s 0.3s linear; }
    .lightbox-overlay.is-visible { opacity: 1; visibility: visible; transition: opacity 0.3s ease; }
    .lightbox-content { width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; overflow: hidden; }
    #lightbox-image { max-width: 95%; max-height: 95%; transition: transform 0.2s cubic-bezier(0.25, 0.1, 0.25, 1); cursor: grab; user-select: none; }
    #lightbox-image:active { cursor: grabbing; }
    .lightbox-close-btn { position: absolute; top: 20px; right: 20px; background: none; border: none; font-size: 2.5rem; color: rgba(255, 255, 255, 0.8); cursor: pointer; transition: color 0.2s ease, transform 0.2s ease; }
    .lightbox-close-btn:hover { color: #fff; transform: scale(1.1); }
</style>